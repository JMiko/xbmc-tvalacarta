# -*- coding: utf-8 -*-
#------------------------------------------------------------
# pelisalacarta - XBMC Plugin
# Canal para http://conectate.gov.ar
# creado por rsantaella
# http://blog.tvalacarta.info/plugin-xbmc/pelisalacarta/
#------------------------------------------------------------

import urlparse,urllib2,urllib,re
import os, sys

from core import logger
from core import config
from core import scrapertools
from core.item import Item
from servers import servertools

__channel__ = "conectate"
__category__ = "F"
__type__ = "generic"
__title__ = "conectate"
__language__ = "ES"
__creationdate__ = "20121130"
__vfanart__ = "http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/bgBody.gif"

DEBUG = config.get_setting("debug")

def isGeneric():
    return True

def mainlist(item):
    logger.info("[conectate.py] mainlist")
    
    itemlist = []
    itemlist.append( Item(channel=__channel__, title="Encuentro", action="encuentro", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=1&canalId=1&tipoEmisionId=3", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_encuentro.png", fanart = __vfanart__)) 
    itemlist.append( Item(channel=__channel__, title="Pakapaka", action="pakapaka", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=2&canalId=2&tipoEmisionId=3", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_pakapaka.png", fanart = __vfanart__)) 
    itemlist.append( Item(channel=__channel__, title="Ronda", action="ronda", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=3&canalId=3&tipoEmisionId=3", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_pakapaka.png", fanart = __vfanart__))
    itemlist.append( Item(channel=__channel__, title="Educ.ar", action="educar", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=125&canalId=125&tipoEmisionId=2", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_educar.png", fanart = __vfanart__))
    itemlist.append( Item(channel=__channel__, title="Conectar igualdad", action="conectar", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=126&canalId=126&tipoEmisionId=2", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_conectarigualdad.png", fanart = __vfanart__))

    return itemlist
def encuentro(item):    logger.info("[conectate.py] encuentro")        # Descarga la pgina   #data = scrapertools.cachePage(item.url)	    itemlist = []    itemlist.append( Item(channel=__channel__, title="Películas", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=1&canalId=1&tipoEmisionId=1", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_encuentro.png", fanart = __vfanart__))     itemlist.append( Item(channel=__channel__, title="Especiales", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=1&canalId=1&tipoEmisionId=2", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_encuentro.png", fanart = __vfanart__))     itemlist.append( Item(channel=__channel__, title="Series", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=1&canalId=1&tipoEmisionId=3", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_encuentro.png", fanart = __vfanart__))    itemlist.append( Item(channel=__channel__, title="Micros", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=1&canalId=1&tipoEmisionId=4", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_encuentro.png", fanart = __vfanart__))    return itemlist	def pakapaka(item):    logger.info("[conectate.py] pakapaka")	    itemlist = []    itemlist.append( Item(channel=__channel__, title="Series", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=2&canalId=2&tipoEmisionId=3", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_pakapaka.png", fanart = __vfanart__))    itemlist.append( Item(channel=__channel__, title="Micros", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=2&canalId=2&tipoEmisionId=4", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_pakapaka.png", fanart = __vfanart__))	    return itemlist	def ronda(item):    logger.info("[conectate.py] ronda")    itemlist = []    itemlist.append( Item(channel=__channel__, title="Series", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=3&canalId=3&tipoEmisionId=3", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_pakapaka.png", fanart = __vfanart__))    itemlist.append( Item(channel=__channel__, title="Micros", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=3&canalId=3&tipoEmisionId=4", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_pakapaka.png", fanart = __vfanart__))	    return itemlist	def educar(item):    logger.info("[conectate.py] educar")	    itemlist = []    itemlist.append( Item(channel=__channel__, title="Especiales", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=125&canalId=125&tipoEmisionId=2", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_educar.png", fanart = __vfanart__)) 	    return itemlist	def conectar(item):    logger.info("[conectate.py] conectar")	    itemlist = []    itemlist.append( Item(channel=__channel__, title="Especiales", action="programas", url="http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?modulo=menu&temaCanalId=126&canalId=126&tipoEmisionId=2", thumbnail="http://conectate.gov.ar/educar-portal-video-web/module/decorator/img/footer_conectarigualdad.png", fanart = __vfanart__))     return itemlist	def programas(item):    logger.info("[conectate.py] programas")        # Descarga la pgina    data = scrapertools.cachePage(item.url)    data = data.decode('iso8859-1').encode('utf-8')    data = data.replace("\n", " ")    data = data.replace("\r", " ")      # replace consecutive spaces into a single one    data = " ".join(data.split())	    #logger.info(data)    #patron = '<div class="resBusquedaEnGrilla_thumb"> <a href="/educar-portal-video-web/module/detalleRecurso/DetalleRecurso.do?([^"]+)"><img src="([^"]+)" alt="([^"]+)" class="linkImg" /></a>'    patron = '<div class="resBusquedaEnGrilla_thumb"> <a href="/educar-portal-video-web/module/detalleRecurso/DetalleRecurso.do?(.*?)"><img src="(.*?)" alt="(.*?)" class="linkImg" /></a>'    matches = re.compile(patron,re.DOTALL).findall(data)    if DEBUG: scrapertools.printMatches(matches)	    itemlist = []    for match in matches:        scrapedurl = "http://conectate.gov.ar/educar-portal-video-web/module/detalleRecurso/DetalleRecurso.do"+match[0]		        scrapedthumbnail = scrapertools.htmlclean(match[1])        scrapedtitle = scrapertools.htmlclean(match[2])        if (item.title == "Películas") or (item.title == "Especiales"):            itemlist.append( Item(channel=__channel__, action="play", title=scrapedtitle , url=scrapedurl , thumbnail=scrapedthumbnail , fanart=scrapedthumbnail,  plot=scrapedurl , folder=False) )        else:            itemlist.append( Item(channel=__channel__, action="capitulos", title=scrapedtitle , url=scrapedurl , thumbnail=scrapedthumbnail , fanart=scrapedthumbnail,  plot=scrapedurl , folder=True) )    patron = '<a href="/educar-portal-video-web/module/busqueda/busquedaAvanzada.do?([^"]+)"> &gt;&gt; </a>'    matches = re.compile(patron,re.DOTALL).findall(data)    if DEBUG: scrapertools.printMatches(matches)	    for match in matches:        scrapedurl = "http://conectate.gov.ar/educar-portal-video-web/module/busqueda/busquedaAvanzada.do"+match		        scrapedtitle = "!Página siguiente"        itemlist.append( Item(channel=__channel__, action="programas", title=scrapedtitle , url=scrapedurl ,  folder=True) )    return itemlist	def capitulos(item):    logger.info("[conectate.py] capitulos")        # Descarga la pgina    data = scrapertools.cachePage(item.url)    data = data.decode('iso8859-1').encode('utf-8')    data = data.replace("\n", " ")    data = data.replace("\r", " ")    data = " ".join(data.split())	    #logger.info(data)    #patron = '</div> <a href="/educar-portal-video-web/module/detalleRecurso/DetalleRecurso.do?([^"]+)">([^"]+)</a>'    patron = '</div> <a href="/educar-portal-video-web/module/detalleRecurso/DetalleRecurso.do?([^"]+)">(.*?)</a>'    matches = re.compile(patron,re.DOTALL).findall(data)    if DEBUG: scrapertools.printMatches(matches)	    itemlist = []    for match in matches:        scrapedurl = "http://conectate.gov.ar/educar-portal-video-web/module/detalleRecurso/DetalleRecurso.do"+match[0]		        scrapedtitle = scrapertools.htmlclean(match[1])		        itemlist.append( Item(channel=__channel__, action="play", title=scrapedtitle , url=scrapedurl ,  folder=False) )        return itemlistdef play(item):    logger.info("[conectate.py] play")        data = scrapertools.cachePage(item.url)	    #logger.info(data)    itemlist = []        patron = '\'hd.file\' : \'([^"]+)\''    matches = re.compile(patron,re.DOTALL).findall(data)    if DEBUG: scrapertools.printMatches(matches)    for match in matches:	        scrapedurl = match        itemlist.append( Item(channel=__channel__, action="play",  server="directo",  title=item.title, url=scrapedurl, folder=False))    return itemlist